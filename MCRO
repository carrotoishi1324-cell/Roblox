-- MACROPEAK | Flick FPS Script
-- Made By @LuaDev
-- Key: LIB201

getgenv().SecureMode = true
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Key System
local Key = "LIB201"
local KeyInput = ""

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game:GetService("CoreGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 400, 0, 250)
Frame.Position = UDim2.new(0.5, -200, 0.5, -125)
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Frame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = Frame

local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(1, 0, 0, 50)
TopBar.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
TopBar.BorderSizePixel = 0
TopBar.Parent = Frame

local UICorner2 = Instance.new("UICorner")
UICorner2.CornerRadius = UDim.new(0, 12)
UICorner2.Parent = TopBar

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 1, 0)
Title.BackgroundTransparency = 1
Title.Text = "MACROPEAK | Flick FPS"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 22
Title.Font = Enum.Font.GothamBold
Title.Parent = TopBar

local Subtitle = Instance.new("TextLabel")
Subtitle.Size = UDim2.new(1, 0, 0, 20)
Subtitle.Position = UDim2.new(0, 0, 0, 55)
Subtitle.BackgroundTransparency = 1
Subtitle.Text = "Made By @LuaDev"
Subtitle.TextColor3 = Color3.fromRGB(180, 180, 200)
Subtitle.TextSize = 14
Subtitle.Font = Enum.Font.Gotham
Subtitle.Parent = Frame

local KeyBox = Instance.new("TextBox")
KeyBox.Size = UDim2.new(0.8, 0, 0, 45)
KeyBox.Position = UDim2.new(0.1, 0, 0.3, 0)
KeyBox.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
KeyBox.TextColor3 = Color3.fromRGB(255, 255, 255)
KeyBox.PlaceholderText = "Enter Key..."
KeyBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 170)
KeyBox.Text = ""
KeyBox.TextSize = 18
KeyBox.Font = Enum.Font.Gotham
KeyBox.ClearTextOnFocus = false
KeyBox.Parent = Frame

local UICorner3 = Instance.new("UICorner")
UICorner3.CornerRadius = UDim.new(0, 8)
UICorner3.Parent = KeyBox

local SubmitBtn = Instance.new("TextButton")
SubmitBtn.Size = UDim2.new(0.6, 0, 0, 45)
SubmitBtn.Position = UDim2.new(0.2, 0, 0.6, 0)
SubmitBtn.BackgroundColor3 = Color3.fromRGB(80, 120, 255)
SubmitBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
SubmitBtn.Text = "ACTIVATE SCRIPT"
SubmitBtn.TextSize = 16
SubmitBtn.Font = Enum.Font.GothamBold
SubmitBtn.Parent = Frame

local UICorner4 = Instance.new("UICorner")
UICorner4.CornerRadius = UDim.new(0, 8)
UICorner4.Parent = SubmitBtn

local Hint = Instance.new("TextLabel")
Hint.Size = UDim2.new(1, 0, 0, 20)
Hint.Position = UDim2.new(0, 0, 0.9, 0)
Hint.BackgroundTransparency = 1
Hint.Text = "Key: LIB201 (Check Discord for updates)"
Hint.TextColor3 = Color3.fromRGB(150, 150, 170)
Hint.TextSize = 12
Hint.Font = Enum.Font.Gotham
Hint.Parent = Frame

local function CheckKey()
    if KeyBox.Text == Key then
        ScreenGui:Destroy()
        return true
    else
        KeyBox.Text = ""
        KeyBox.PlaceholderText = "❌ Wrong Key! Try Again"
        KeyBox.PlaceholderColor3 = Color3.fromRGB(255, 100, 100)
        return false
    end
end

SubmitBtn.MouseButton1Click:Connect(CheckKey)
KeyBox.Focused:Connect(function()
    KeyBox.PlaceholderText = "Enter Key..."
    KeyBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 170)
end)

KeyBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        CheckKey()
    end
end)

-- Wait for correct key
repeat
    task.wait()
until not ScreenGui.Parent

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")

-- Variables
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- Create Window
local Window = Rayfield:CreateWindow({
    Name = "MACROPEAK | Flick",
    LoadingTitle = "Loading MACROPEAK...",
    LoadingSubtitle = "Made By @LuaDev",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MACROPEAK",
        FileName = "FlickConfig"
    },
    Discord = {
        Enabled = true,
        Invite = "discord.gg/macropeaks",
        RememberJoins = true
    },
})

-- FOV Circle
local FOVCircle = Drawing.new("Circle")
FOVCircle.Visible = false
FOVCircle.Radius = 120
FOVCircle.Color = Color3.fromRGB(255, 50, 50)
FOVCircle.Thickness = 1.5
FOVCircle.Filled = false
FOVCircle.Transparency = 1
FOVCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

-- Rainbow Color
local Hue = 0
local function RainbowColor()
    Hue = (Hue + 0.01) % 1
    return Color3.fromHSV(Hue, 1, 1)
end

-- Get Closest Player
local function GetClosestPlayer(FOV)
    local ClosestPlayer = nil
    local ShortestDistance = FOV or math.huge
    
    for _, Player in pairs(Players:GetPlayers()) do
        if Player ~= LocalPlayer and Player.Character then
            local Character = Player.Character
            local Humanoid = Character:FindFirstChild("Humanoid")
            local RootPart = Character:FindFirstChild("HumanoidRootPart")
            
            if Humanoid and Humanoid.Health > 0 and RootPart then
                local ScreenPosition, OnScreen = Camera:WorldToViewportPoint(RootPart.Position)
                
                if OnScreen then
                    local MousePosition = UserInputService:GetMouseLocation()
                    local Distance = (Vector2.new(MousePosition.X, MousePosition.Y) - Vector2.new(ScreenPosition.X, ScreenPosition.Y)).Magnitude
                    
                    if Distance < ShortestDistance then
                        ClosestPlayer = Player
                        ShortestDistance = Distance
                    end
                end
            end
        end
    end
    
    return ClosestPlayer
end

-- Silent Aim Variables
local SilentAimEnabled = false
local SilentAimFOV = 100
local SilentAimHitPart = "Head"

-- Hook Namecall for Silent Aim
local OldNamecall
OldNamecall = hookmetamethod(game, "__namecall", function(Self, ...)
    local Method = getnamecallmethod()
    local Args = {...}
    
    if SilentAimEnabled and Method == "FindPartOnRayWithIgnoreList" and not checkcaller() then
        local ClosestPlayer = GetClosestPlayer(SilentAimFOV)
        if ClosestPlayer and ClosestPlayer.Character then
            local TargetPart = ClosestPlayer.Character:FindFirstChild(SilentAimHitPart)
            if TargetPart then
                local Origin = Camera.CFrame.Position
                local Direction = (TargetPart.Position - Origin).Unit * 1000
                return TargetPart, TargetPart.Position, Direction, TargetPart.Material
            end
        end
    end
    
    return OldNamecall(Self, unpack(Args))
end)

-- ESP Variables
local ESPEnabled = false
local ESPBoxes = {}
local ESPLines = {}
local ESPNames = {}
local ESPHealth = {}
local ESPDistance = {}
local TeamCheckESP = true

-- Create ESP
local function CreateESP(Player)
    if ESPBoxes[Player] then return end
    
    local Box = Drawing.new("Square")
    Box.Visible = false
    Box.Color = Color3.fromRGB(255, 255, 255)
    Box.Thickness = 1.5
    Box.Filled = false
    ESPBoxes[Player] = Box
    
    local Line = Drawing.new("Line")
    Line.Visible = false
    Line.Color = Color3.fromRGB(255, 255, 255)
    Line.Thickness = 1.5
    ESPLines[Player] = Line
    
    local Name = Drawing.new("Text")
    Name.Visible = false
    Name.Color = Color3.fromRGB(255, 255, 255)
    Name.Size = 13
    Name.Center = true
    Name.Outline = true
    Name.Font = 2
    ESPNames[Player] = Name
    
    local Health = Drawing.new("Text")
    Health.Visible = false
    Health.Color = Color3.fromRGB(255, 255, 255)
    Health.Size = 11
    Health.Center = true
    Health.Outline = true
    Health.Font = 2
    ESPHealth[Player] = Health
    
    local Distance = Drawing.new("Text")
    Distance.Visible = false
    Distance.Color = Color3.fromRGB(255, 255, 255)
    Distance.Size = 11
    Distance.Center = true
    Distance.Outline = true
    Distance.Font = 2
    ESPDistance[Player] = Distance
end

-- Remove ESP
local function RemoveESP(Player)
    if ESPBoxes[Player] then
        ESPBoxes[Player]:Remove()
        ESPBoxes[Player] = nil
    end
    if ESPLines[Player] then
        ESPLines[Player]:Remove()
        ESPLines[Player] = nil
    end
    if ESPNames[Player] then
        ESPNames[Player]:Remove()
        ESPNames[Player] = nil
    end
    if ESPHealth[Player] then
        ESPHealth[Player]:Remove()
        ESPHealth[Player] = nil
    end
    if ESPDistance[Player] then
        ESPDistance[Player]:Remove()
        ESPDistance[Player] = nil
    end
end

-- Update ESP
local function UpdateESP()
    for Player, Box in pairs(ESPBoxes) do
        if Player and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
            local Character = Player.Character
            local Humanoid = Character:FindFirstChild("Humanoid")
            local RootPart = Character:FindFirstChild("HumanoidRootPart")
            
            if Humanoid and RootPart then
                local Position, OnScreen = Camera:WorldToViewportPoint(RootPart.Position)
                
                if OnScreen then
                    local BoxSize = Vector2.new(2000 / Position.Z, 3000 / Position.Z)
                    local BoxPosition = Vector2.new(Position.X - BoxSize.X / 2, Position.Y - BoxSize.Y / 2)
                    
                    -- Team Check
                    local TeamColor = Color3.fromRGB(255, 50, 50)
                    if TeamCheckESP and Player.Team and LocalPlayer.Team and Player.Team == LocalPlayer.Team then
                        TeamColor = Color3.fromRGB(50, 150, 255)
                    end
                    
                    -- Box
                    Box.Size = BoxSize
                    Box.Position = BoxPosition
                    Box.Color = TeamColor
                    Box.Visible = ESPEnabled
                    
                    -- Line
                    local Line = ESPLines[Player]
                    if Line then
                        Line.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                        Line.To = Vector2.new(Position.X, Position.Y)
                        Line.Color = TeamColor
                        Line.Visible = ESPEnabled
                    end
                    
                    -- Name
                    local Name = ESPNames[Player]
                    if Name then
                        Name.Position = Vector2.new(Position.X, Position.Y - BoxSize.Y / 2 - 15)
                        Name.Text = Player.Name
                        Name.Color = TeamColor
                        Name.Visible = ESPEnabled
                    end
                    
                    -- Health
                    local HealthText = ESPHealth[Player]
                    if HealthText then
                        HealthText.Position = Vector2.new(Position.X, Position.Y + BoxSize.Y / 2 + 5)
                        HealthText.Text = "HP: " .. math.floor(Humanoid.Health)
                        HealthText.Color = Color3.fromRGB(0, 255, 0):Lerp(Color3.fromRGB(255, 0, 0), 1 - (Humanoid.Health / Humanoid.MaxHealth))
                        HealthText.Visible = ESPEnabled
                    end
                    
                    -- Distance
                    local DistanceText = ESPDistance[Player]
                    if DistanceText then
                        local Distance = (LocalPlayer.Character:FindFirstChild("HumanoidRootPart").Position - RootPart.Position).Magnitude
                        DistanceText.Position = Vector2.new(Position.X, Position.Y + BoxSize.Y / 2 + 20)
                        DistanceText.Text = math.floor(Distance) .. " studs"
                        DistanceText.Color = Color3.fromRGB(255, 255, 255)
                        DistanceText.Visible = ESPEnabled
                    end
                else
                    Box.Visible = false
                    if ESPLines[Player] then ESPLines[Player].Visible = false end
                    if ESPNames[Player] then ESPNames[Player].Visible = false end
                    if ESPHealth[Player] then ESPHealth[Player].Visible = false end
                    if ESPDistance[Player] then ESPDistance[Player].Visible = false end
                end
            else
                Box.Visible = false
                if ESPLines[Player] then ESPLines[Player].Visible = false end
                if ESPNames[Player] then ESPNames[Player].Visible = false end
                if ESPHealth[Player] then ESPHealth[Player].Visible = false end
                if ESPDistance[Player] then ESPDistance[Player].Visible = false end
            end
        else
            RemoveESP(Player)
        end
    end
end

-- Initialize ESP for all players
for _, Player in pairs(Players:GetPlayers()) do
    if Player ~= LocalPlayer then
        CreateESP(Player)
    end
end

-- Player events
Players.PlayerAdded:Connect(function(Player)
    CreateESP(Player)
end)

Players.PlayerRemoving:Connect(function(Player)
    RemoveESP(Player)
end)

-- Silent Aim Tab
local SilentAimTab = Window:CreateTab("Silent Aim", 13079117154)
SilentAimTab:CreateSection("Silent Aim Settings")

local SilentAimToggle = SilentAimTab:CreateToggle({
    Name = "Enable Silent Aim",
    CurrentValue = false,
    Flag = "SilentAimToggle",
    Callback = function(Value)
        SilentAimEnabled = Value
    end,
})

local SilentAimFOVSlider = SilentAimTab:CreateSlider({
    Name = "Silent Aim FOV",
    Range = {1, 500},
    Increment = 1,
    Suffix = "studs",
    CurrentValue = 100,
    Flag = "SilentAimFOV",
    Callback = function(Value)
        SilentAimFOV = Value
    end,
})

local SilentAimHitPartDropdown = SilentAimTab:CreateDropdown({
    Name = "Hit Part",
    Options = {"Head", "HumanoidRootPart", "Torso", "Random"},
    CurrentOption = "Head",
    Flag = "SilentAimHitPart",
    Callback = function(Option)
        SilentAimHitPart = Option
    end,
})

-- Aimbot Tab
local AimbotTab = Window:CreateTab("Aimbot", 6031075938)
AimbotTab:CreateSection("Aimbot Settings")

local AimbotEnabled = false
local Prediction = 0.14
local TeamCheck = true
local DeadCheck = true

local AimbotToggle = AimbotTab:CreateToggle({
    Name = "Enable Aimbot",
    CurrentValue = false,
    Flag = "AimbotToggle",
    Callback = function(Value)
        AimbotEnabled = Value
    end,
})

local PredictionSlider = AimbotTab:CreateSlider({
    Name = "Prediction",
    Range = {0.1, 2.0},
    Increment = 0.1,
    Suffix = "sec",
    CurrentValue = 0.14,
    Flag = "Prediction",
    Callback = function(Value)
        Prediction = Value
    end,
})

local TeamCheckToggle = AimbotTab:CreateToggle({
    Name = "Team Check",
    CurrentValue = true,
    Flag = "TeamCheck",
    Callback = function(Value)
        TeamCheck = Value
    end,
})

local DeadCheckToggle = AimbotTab:CreateToggle({
    Name = "Dead Check",
    CurrentValue = true,
    Flag = "DeadCheck",
    Callback = function(Value)
        DeadCheck = Value
    end,
})

AimbotTab:CreateSection("FOV Settings")

local VisibleFOVToggle = AimbotTab:CreateToggle({
    Name = "Show FOV Circle",
    CurrentValue = true,
    Flag = "ShowFOV",
    Callback = function(Value)
        FOVCircle.Visible = Value
    end,
})

local FOVSizeSlider = AimbotTab:CreateSlider({
    Name = "FOV Size",
    Range = {10, 500},
    Increment = 5,
    Suffix = "studs",
    CurrentValue = 120,
    Flag = "FOVSize",
    Callback = function(Value)
        FOVCircle.Radius = Value
    end,
})

local RainbowFOVToggle = AimbotTab:CreateToggle({
    Name = "Rainbow FOV",
    CurrentValue = false,
    Flag = "RainbowFOV",
    Callback = function(Value)
        -- Handled in render loop
    end,
})

local RainbowSpeedSlider = AimbotTab:CreateSlider({
    Name = "Rainbow Speed",
    Range = {1, 100},
    Increment = 1,
    Suffix = "%",
    CurrentValue = 50,
    Flag = "RainbowSpeed",
    Callback = function(Value)
        -- Speed handled in render loop
    end,
})

-- ESP Tab
local ESPTab = Window:CreateTab("ESP", 6031280881)
ESPTab:CreateSection("ESP Settings")

local ESPToggle = ESPTab:CreateToggle({
    Name = "Enable ESP",
    CurrentValue = false,
    Flag = "ESPToggle",
    Callback = function(Value)
        ESPEnabled = Value
        UpdateESP()
    end,
})

local TeamCheckerToggle = ESPTab:CreateToggle({
    Name = "Team Checker",
    CurrentValue = true,
    Flag = "TeamChecker",
    Callback = function(Value)
        TeamCheckESP = Value
        UpdateESP()
    end,
})

local ESPLinesToggle = ESPTab:CreateToggle({
    Name = "ESP Lines",
    CurrentValue = true,
    Flag = "ESPLines",
    Callback = function(Value)
        -- Lines visibility handled in UpdateESP
    end,
})

local ESPBoxesToggle = ESPTab:CreateToggle({
    Name = "ESP Boxes",
    CurrentValue = true,
    Flag = "ESPBoxes",
    Callback = function(Value)
        -- Boxes visibility handled in UpdateESP
    end,
})

-- Triggerbot Tab
local TriggerbotTab = Window:CreateTab("Triggerbot", 6031304514)
TriggerbotTab:CreateSection("Triggerbot Settings")

local TriggerbotEnabled = false
local InstantReaction = true
local TriggerbotDelay = 0

local TriggerbotToggle = TriggerbotTab:CreateToggle({
    Name = "Enable Triggerbot",
    CurrentValue = false,
    Flag = "TriggerbotToggle",
    Callback = function(Value)
        TriggerbotEnabled = Value
    end,
})

local InstantReactionToggle = TriggerbotTab:CreateToggle({
    Name = "Instant Reaction",
    CurrentValue = true,
    Flag = "InstantReaction",
    Callback = function(Value)
        InstantReaction = Value
    end,
})

local TriggerbotDelaySlider = TriggerbotTab:CreateSlider({
    Name = "Reaction Delay",
    Range = {0, 100},
    Increment = 1,
    Suffix = "ms",
    CurrentValue = 0,
    Flag = "TriggerbotDelay",
    Callback = function(Value)
        TriggerbotDelay = Value / 1000
    end,
})

local TriggerbotHitChanceSlider = TriggerbotTab:CreateSlider({
    Name = "Hit Chance",
    Range = {1, 100},
    Increment = 1,
    Suffix = "%",
    CurrentValue = 100,
    Flag = "HitChance",
    Callback = function(Value)
        -- Hit chance logic
    end,
})

-- Movement Tab
local MovementTab = Window:CreateTab("Movement", 6031075940)
MovementTab:CreateSection("Movement Settings")

local SpeedEnabled = false
local SpeedMultiplier = 2
local OriginalWalkSpeed = 16

local SpeedToggle = MovementTab:CreateToggle({
    Name = "Speed Hack",
    CurrentValue = false,
    Flag = "SpeedToggle",
    Callback = function(Value)
        SpeedEnabled = Value
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            if Value then
                OriginalWalkSpeed = LocalPlayer.Character.Humanoid.WalkSpeed
                LocalPlayer.Character.Humanoid.WalkSpeed = OriginalWalkSpeed * SpeedMultiplier
            else
                LocalPlayer.Character.Humanoid.WalkSpeed = OriginalWalkSpeed
            end
        end
    end,
})

local SpeedSlider = MovementTab:CreateSlider({
    Name = "Speed Multiplier",
    Range = {1, 10},
    Increment = 0.1,
    Suffix = "x",
    CurrentValue = 2,
    Flag = "SpeedMultiplier",
    Callback = function(Value)
        SpeedMultiplier = Value
        if SpeedEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = OriginalWalkSpeed * Value
        end
    end,
})

local JumpHeightEnabled = false
local JumpHeightMultiplier = 2
local OriginalJumpHeight = 50

local JumpHeightToggle = MovementTab:CreateToggle({
    Name = "Jump Height",
    CurrentValue = false,
    Flag = "JumpHeightToggle",
    Callback = function(Value)
        JumpHeightEnabled = Value
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            if Value then
                OriginalJumpHeight = LocalPlayer.Character.Humanoid.JumpHeight
                LocalPlayer.Character.Humanoid.JumpHeight = OriginalJumpHeight * JumpHeightMultiplier
            else
                LocalPlayer.Character.Humanoid.JumpHeight = OriginalJumpHeight
            end
        end
    end,
})

local JumpHeightSlider = MovementTab:CreateSlider({
    Name = "Jump Height",
    Range = {20, 200},
    Increment = 5,
    Suffix = "studs",
    CurrentValue = 100,
    Flag = "JumpHeightValue",
    Callback = function(Value)
        JumpHeightMultiplier = Value / 50
        if JumpHeightEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.JumpHeight = OriginalJumpHeight * JumpHeightMultiplier
        end
    end,
})

local InfiniteJumpEnabled = false

local InfiniteJumpToggle = MovementTab:CreateToggle({
    Name = "Infinite Jump",
    CurrentValue = false,
    Flag = "InfiniteJump",
    Callback = function(Value)
        InfiniteJumpEnabled = Value
    end,
})

-- Visuals Tab
local VisualsTab = Window:CreateTab("Visuals", 6031068426)
VisualsTab:CreateSection("Visual Settings")

local RemoveFogToggle = VisualsTab:CreateToggle({
    Name = "Remove Fog",
    CurrentValue = false,
    Flag = "RemoveFog",
    Callback = function(Value)
        if Value then
            Lighting.FogEnd = 1000000
            Lighting.FogStart = 1000000
        else
            Lighting.FogEnd = 1000
            Lighting.FogStart = 0
        end
    end,
})

local RemoveAtmosphereToggle = VisualsTab:CreateToggle({
    Name = "Remove Atmosphere",
    CurrentValue = false,
    Flag = "RemoveAtmosphere",
    Callback = function(Value)
        if Lighting:FindFirstChild("Atmosphere") then
            if Value then
                Lighting.Atmosphere.Density = 0
                Lighting.Atmosphere.Offset = 999999
                Lighting.Atmosphere.Decay = Color3.new(1, 1, 1)
                Lighting.Atmosphere.Glare = 0
                Lighting.Atmosphere.Haze = 0
            else
                Lighting.Atmosphere.Density = 0.5
                Lighting.Atmosphere.Offset = 0
                Lighting.Atmosphere.Decay = Color3.new(0.8, 0.8, 0.8)
                Lighting.Atmosphere.Glare = 0.5
                Lighting.Atmosphere.Haze = 0.5
            end
        end
    end,
})

local RemoveTreesToggle = VisualsTab:CreateToggle({
    Name = "Remove Trees",
    CurrentValue = false,
    Flag = "RemoveTrees",
    Callback = function(Value)
        for _, obj in pairs(Workspace:GetDescendants()) do
            if obj:IsA("Part") and (obj.Name:find("Tree") or obj.Name:find("Bush") or obj.Name:find("Leaf")) then
                if Value then
                    obj.Transparency = 1
                    obj.CanCollide = false
                    if obj:FindFirstChildOfClass("Decal") then
                        obj:FindFirstChildOfClass("Decal").Transparency = 1
                    end
                else
                    obj.Transparency = 0
                    obj.CanCollide = true
                    if obj:FindFirstChildOfClass("Decal") then
                        obj:FindFirstChildOfClass("Decal").Transparency = 0
                    end
                end
            end
        end
    end,
})

local ContrastSlider = VisualsTab:CreateSlider({
    Name = "Contrast",
    Range = {0, 2},
    Increment = 0.1,
    Suffix = "x",
    CurrentValue = 1,
    Flag = "Contrast",
    Callback = function(Value)
        if not Lighting:FindFirstChild("ColorCorrection") then
            local cc = Instance.new("ColorCorrectionEffect")
            cc.Parent = Lighting
        end
        Lighting.ColorCorrection.Contrast = Value
    end,
})

-- Miscellaneous Tab
local MiscTab = Window:CreateTab("Miscellaneous", 6031280881)
MiscTab:CreateSection("Weapon Mods")

local NoRecoilEnabled = false
local NoSpreadEnabled = false
local RapidFireEnabled = false
local InfiniteAmmoEnabled = false

local NoRecoilToggle = MiscTab:CreateToggle({
    Name = "No Recoil",
    CurrentValue = false,
    Flag = "NoRecoil",
    Callback = function(Value)
        NoRecoilEnabled = Value
    end,
})

local NoSpreadToggle = MiscTab:CreateToggle({
    Name = "No Spread",
    CurrentValue = false,
    Flag = "NoSpread",
    Callback = function(Value)
        NoSpreadEnabled = Value
    end,
})

local RapidFireToggle = MiscTab:CreateToggle({
    Name = "Rapid Fire",
    CurrentValue = false,
    Flag = "RapidFire",
    Callback = function(Value)
        RapidFireEnabled = Value
    end,
})

local InfiniteAmmoToggle = MiscTab:CreateToggle({
    Name = "Infinite Ammo",
    CurrentValue = false,
    Flag = "InfiniteAmmo",
    Callback = function(Value)
        InfiniteAmmoEnabled = Value
    end,
})

MiscTab:CreateSection("Other")

local AutoReloadToggle = MiscTab:CreateToggle({
    Name = "Auto Reload",
    CurrentValue = false,
    Flag = "AutoReload",
    Callback = function(Value)
        -- Auto reload logic
    end,
})

-- Render Stepped Loop
RunService.RenderStepped:Connect(function()
    -- Update FOV Circle position
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    -- Rainbow FOV
    if RainbowFOVToggle.CurrentValue then
        FOVCircle.Color = RainbowColor()
    end
    
    -- Update ESP
    UpdateESP()
    
    -- Aimbot Logic
    if AimbotEnabled and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        local ClosestPlayer = GetClosestPlayer(FOVCircle.Radius)
        if ClosestPlayer and ClosestPlayer.Character then
            local Humanoid = ClosestPlayer.Character:FindFirstChild("Humanoid")
            local RootPart = ClosestPlayer.Character:FindFirstChild("HumanoidRootPart")
            
            if Humanoid and RootPart then
                if TeamCheck and ClosestPlayer.Team and LocalPlayer.Team and ClosestPlayer.Team == LocalPlayer.Team then
                    return
                end
                
                if DeadCheck and Humanoid.Health <= 0 then
                    return
                end
                
                local TargetPart = ClosestPlayer.Character:FindFirstChild("Head") or RootPart
                if TargetPart then
                    local PredictedPosition = TargetPart.Position + (TargetPart.Velocity * Prediction)
                    local ScreenPosition = Camera:WorldToScreenPoint(PredictedPosition)
                    
                    if ScreenPosition then
                        mousemoverel(ScreenPosition.X - Mouse.X, ScreenPosition.Y - Mouse.Y)
                    end
                end
            end
        end
    end
    
    -- Triggerbot Logic
    if TriggerbotEnabled then
        local Target = Mouse.Target
        if Target and Target.Parent then
            local Player = Players:GetPlayerFromCharacter(Target.Parent)
            if Player and Player ~= LocalPlayer then
                local Humanoid = Target.Parent:FindFirstChild("Humanoid")
                if Humanoid and Humanoid.Health > 0 then
                    if InstantReaction then
                        task.wait(TriggerbotDelay)
                        mouse1click()
                    end
                end
            end
        end
    end
    
    -- Infinite Jump
    if InfiniteJumpEnabled and UserInputService:IsKeyDown(Enum.KeyCode.Space) then
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

-- Character Added Event
LocalPlayer.CharacterAdded:Connect(function(Character)
    task.wait(1)
    if Character:FindFirstChild("Humanoid") then
        if SpeedEnabled then
            OriginalWalkSpeed = Character.Humanoid.WalkSpeed
            Character.Humanoid.WalkSpeed = OriginalWalkSpeed * SpeedMultiplier
        end
        if JumpHeightEnabled then
            OriginalJumpHeight = Character.Humanoid.JumpHeight
            Character.Humanoid.JumpHeight = OriginalJumpHeight * JumpHeightMultiplier
        end
    end
end)

-- Weapon Mods Hook
local OldIndex
OldIndex = hookmetamethod(game, "__index", function(Self, Key)
    if NoRecoilEnabled and tostring(Self):find("Gun") and Key == "Recoil" then
        return 0
    end
    
    if NoSpreadEnabled and tostring(Self):find("Gun") and Key == "Spread" then
        return 0
    end
    
    if RapidFireEnabled and tostring(Self):find("Gun") and Key == "FireRate" then
        return 0.01
    end
    
    if InfiniteAmmoEnabled and tostring(Self):find("Ammo") then
        return math.huge
    end
    
    return OldIndex(Self, Key)
end)

-- Notify Loaded
task.wait(1)
Rayfield:Notify({
    Title = "MACROPEAK | Flick FPS",
    Content = "Successfully loaded!\nKey: LIB201\nAll features are active.",
    Duration = 6,
    Image = 6031075938
})

-- Script Info
Window:CreateLabel("MACROPEAK | Flick FPS v2.0")
Window:CreateLabel("Made By @LuaDev")
Window:CreateLabel("Key System: LIB201 (Activated)")
Window:CreateLabel("Status: ✅ All features loaded")
